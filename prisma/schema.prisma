// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = []
  binaryTargets   = ["native", "linux-arm64-openssl-3.0.x"]
}

generator dbml {
  provider = "prisma-dbml-generator"
}

generator prisma-class-generator {
  provider                 = "prisma-class-generator"
  dryRun                   = "false"
  output                   = "dtos"
  useSwagger               = "true"
  makeIndexFile            = "true"
  separateRelationFields   = "true"
  clientImportPath         = "@prisma/client"
  useNonNullableAssertions = "false"
  preserveDefaultNullable  = "false"
}

// -------------------------------- Models ------------------------------
model User {
  id                 Int          @id @default(autoincrement())
  email              String       @unique
  password           String
  temporaryPassword  String?
  firstName          String
  lastName           String
  fullName           String
  phoneNumber        String?
  status             UserStatus   @default(Active)
  dob                DateTime?
  role               UserRole
  gender             Gender       @default(Other)
  address            String?
  city               String?
  country            String?
  imageLink          String?
  lastActive         DateTime?
  forceResetPassword Boolean      @default(false)
  language           UserLanguage @default(En)
  profession         String?
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  isDeleted          Boolean      @default(false)

  // Relationships
  resumes Resume[]
}

model Resume {
  id           Int      @id @default(autoincrement())
  userId       Int?
  title        String?
  avatar       String?
  name         String?
  dateOfBirth  DateTime?
  gender       Gender?
  email        String?
  phoneNumber  String?
  address      String?
  profession   String?
  language     String?
  website      String[]
  professional String?
  summary      String?
  skills       String[]
  experiences  Json?
  educations   Json?
  projects     Json?
  template     String?  @default("classic")
  accentColor  String?  @default("#3B82F6")
  fontFamily   String?  @default("inter")
  isPublic     Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  isDeleted    Boolean  @default(false)

  // Relationships
  user User? @relation(fields: [userId], references: [id])
}

// model Experience {
//   id              Int          @id @default(autoincrement())
//   resumeId        Int
//   companyName     String
//   jobTitle        String
//   startDate       DateTime
//   endDate         DateTime?
//   isCurrent       Boolean      @default(false)
//   jobDescription  String?
//   createdAt       DateTime     @default(now())
//   updatedAt       DateTime     @updatedAt
//   isDeleted       Boolean      @default(false)

//   // Relationships
//   resume          Resume       @relation(fields: [resumeId], references: [id])
// }

// model Education {
//   id              Int          @id @default(autoincrement())
//   resumeId        Int
//   institutionName String
//   degree          String
//   fieldOfStudy    String?
//   graduationDate  DateTime
//   gpa             String?
//   createdAt       DateTime     @default(now())
//   updatedAt       DateTime     @updatedAt
//   isDeleted       Boolean      @default(false)

//   // Relationships
//   resume          Resume       @relation(fields: [resumeId], references: [id])
// }

// model Project {
//   id              Int          @id @default(autoincrement())
//   resumeId        Int
//   projectName     String
//   description     String?
//   technologies    String?
//   createdAt       DateTime     @default(now())
//   updatedAt       DateTime     @updatedAt
//   isDeleted       Boolean      @default(false)

//   // Relationships
//   resume          Resume       @relation(fields: [resumeId], references: [id])
// }

model Storage {
  id           Int      @id @default(autoincrement())
  userId       Int?
  filename     String   @unique
  path         String
  mimetype     String?
  size         Int
  originalname String
  encoding     String?
  destination  String?
  epicId       Int?
  storyId      Int?
  taskId       Int?
  subTaskId    Int?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  isDeleted    Boolean  @default(false)
}

model AuditTrail {
  id        Int            @id @default(autoincrement())
  userId    Int
  before    Json
  after     Json?
  diffs     Json?
  type      AuditTrailType
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  isDeleted Boolean        @default(false)
}

model History {
  id        Int         @id @default(autoincrement())
  userId    Int
  condition Json
  content   Json
  type      HistoryType
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  isDeleted Boolean     @default(false)
}

// -------------------------------- Enums -------------------------------
enum UserRole {
  Admin
  Leader
  Staff
}

enum ProjectRole {
  PM
  Developer
  Tester
}

enum WorkingStatus {
  Active
  OnLeave
  Inactive
}

// enum TeamRole {
//   TeamLead
//   Frontend
//   Backend
// }

enum ProjectPrivacy {
  Public
  Private
}

enum ProjectStatus {
  Planned
  Active
  Completed
  Archived
}

enum UserStatus {
  Active
  Inactive
  Closed
}

enum WorkStatus {
  Todo
  Development
  InProgress
  DoneTesting
  Review
  Done
}

enum LabelType {
  Design
  API
  Dev
  Bug
  Planning
}

enum Priority {
  Low
  Medium
  High
}

// enum LinkType {
//   RelatesTo
//   IsBlockedBy
//   Blocks
//   IsCausedBy
//   Causes
//   Duplicates
//   IsDuplicatedBy
//   Resolves
//   IsResolvedBy
//   Clones
// }

enum Gender {
  Male
  Female
  Other
}

enum UserLanguage {
  En
  Vn
}

enum AuditTrailType {
  Update
}

enum HistoryType {
  Update
}
